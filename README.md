# devslot

```
devslot - Development environment manager for multi-repo worktrees

USAGE:
  devslot <command> [options]

COMMANDS:
  boilerplate <dir>      Generate initial project structure in the specified directory
  init [--allow-delete]  Sync bare repositories defined in devslot.yaml into repos/
  create <slot> [-b <branch>]  Create a new slot (multi-repo worktree environment)
  destroy <slot>         Remove the specified slot (runs pre-destroy hook if exists)
  reload <slot>          Ensure all worktrees exist for the slot and run post-reload hook
  list                   List all existing slots
  doctor                 Check consistency of project structure and repositories
  version                Show devslot version

FLAGS:
  -h, --help             Show this help message
  -v, --version          Show version (alias for `version`)
  --verbose              Enable verbose logging

NOTES:
  - All operations are scoped to the devslot project root directory
    (detected by presence of devslot.yaml).

  - To prevent concurrent modifications, all operations acquire an exclusive lock
    on .devslot.lock in the project root directory.

  - Standard directory structure after `boilerplate`:
      <target-dir>/
      ├── devslot.yaml        # Project definition (version, repositories)
      ├── .gitignore          # Excludes repos/ and slots/
      ├── hooks/              # Optional lifecycle hook scripts (see below)
      ├── repos/              # Bare repositories cloned by `init`
      └── slots/              # Per-slot worktrees created by `create`

    The <dir> argument is required for `boilerplate`.
    Use `.` to initialize the current directory. If the directory does not exist,
    it will be created. All standard files and directories will be generated.

  - Lifecycle hook scripts (optional; generated by `boilerplate`):
      hooks/post-create      → Runs after `create <slot>` (if exists)
      hooks/pre-destroy      → Runs before `destroy <slot>` (if exists)
      hooks/post-reload      → Runs after `reload <slot>` (if exists)

    These scripts are optional. Operations will proceed normally if hooks are not present.
    If a hook exists and fails (non-zero exit), the operation will be aborted.

  - Each hook receives the following environment variables:
      DEVSLOT_ROOT           # Path to devslot project root
      DEVSLOT_SLOT_NAME      # Name of the target slot
      DEVSLOT_SLOT_DIR       # Path to the slot directory
      DEVSLOT_REPOS_DIR      # Path to the bare repositories

  - init behavior:
      - Clones any missing repositories listed in devslot.yaml into repos/
      - Does not affect slots or worktrees
      - Repositories no longer listed will be deleted only with `--allow-delete`

  - create behavior:
      - Creates a new slot with worktrees for all repositories
      - With -b/--branch: checks out the specified branch in all worktrees
      - Without -b/--branch: checks out the default branch of each repository
      - Runs post-create hook if it exists

  - reload behavior:
      - Ensures all repositories are checked out as worktrees for the given slot
      - Automatically adds any missing worktrees before running post-reload hook if it exists

  - devslot.yaml example:
      version: 1
      repositories:
        - name: app1.git
          url: https://github.com/example/app1.git
        - name: app2.git
          url: https://github.com/example/app2.git

  - repos/ and slots/ are ignored from version control (see boilerplate .gitignore)

Project homepage and documentation: https://github.com/yammerjp/devslot
```

## Release Process

This project uses [tagpr](https://github.com/Songmu/tagpr) for automated release management:

1. When changes are merged to `main`, tagpr automatically creates/updates a release PR
2. The release PR includes the next version number and CHANGELOG updates
3. Merging the release PR triggers:
   - Tag creation by tagpr
   - Binary releases by GoReleaser

### Setup Requirements

To enable the full release workflow:

1. **Repository Settings**: Enable "Allow GitHub Actions to create and approve pull requests" under Settings > Actions > General
2. **Personal Access Token (Optional but Recommended)**:
   - Create a PAT with `repo` and `workflow` scopes
   - Add it as `TAGPR_PAT` secret in the repository
   - This allows tagpr to trigger the release workflow

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
